<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow rounded-4 border border-light">
            <div class="card-body">
                <div class="mb-3 fw-bold" style="color: #274472;">¿Qué Profesional estás buscando?</div>
                <div class="mb-3">
                    <input class="form-control form-control-lg rounded-3 border-primary"
                           placeholder="Buscar por nombre o especialidad"
                           @bind="SearchText" />
                </div>
                <div class="d-flex gap-2 mb-3">
                    <button class="btn btn-primary" @onclick="HandleBuscar">🔍 Buscar</button>
                    <button class="btn btn-outline-primary" @onclick="ToggleFiltros">⚙️ Filtros de búsqueda</button>
                </div>
                @if (MostrarFiltros)
                {
                    <div class="card p-3 mb-3" style="background-color: AliceBlue; border-color: LightBlue;">
                        <div class="fw-bold mb-2" style="color: #274472;">🔎 Buscar en:</div>
                        <div class="row mb-2">
                            <div class="col-6 d-flex align-items-center">
                                <input type="checkbox" class="form-check-input me-2" @bind="FiltrarPorNombre" />
                                <label class="form-check-label">📖 Nombre</label>
                            </div>
                            <div class="col-6 d-flex align-items-center">
                                <input type="checkbox" class="form-check-input me-2" @bind="FiltrarPorEspecialidad" />
                                <label class="form-check-label">✍️ Especialidad</label>
                            </div>
                        </div>
                        <button class="btn btn-warning text-white mt-2" @onclick="LimpiarBusqueda">🗑️ Limpiar búsqueda</button>
                    </div>
                }
                @if (IsBusy)
                {
                    <div class="d-flex align-items-center justify-content-center gap-2 mt-2">
                        <div class="spinner-border text-primary" role="status"></div>
                        <span class="text-primary">Buscando profesionales...</span>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

@code {
    // Estado de búsqueda y filtros
    [Parameter] 
    public List<Profesional>? Profesionales { get; set; } = new();
    [Parameter]
    public EventCallback<FilterProfesionalDTO> OnBuscar { get; set; }

    string SearchText { get; set; } = "";
    bool MostrarFiltros { get; set; } = false;
    bool FiltrarPorNombre { get; set; } = true;
    bool FiltrarPorEspecialidad { get; set; } = false;
    bool IsBusy { get; set; } = false;


    // Métodos de UI
    void ToggleFiltros() => MostrarFiltros = !MostrarFiltros;

    async Task LimpiarBusqueda()
    {
        SearchText = "";
        FiltrarPorNombre = true;
        FiltrarPorEspecialidad = false;
        await HandleBuscar();
    }
    private async Task HandleBuscar()
    {
        FilterProfesionalDTO filterProfesionalDTO = new()
        {
            SearchText = SearchText,
            ForNombre = FiltrarPorNombre,
            ForEspecialidad = FiltrarPorEspecialidad
        };
        IsBusy = true;
        await OnBuscar.InvokeAsync(filterProfesionalDTO);
        IsBusy = false;
    }
}
